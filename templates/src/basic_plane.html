{% load static %}
<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>NDAS : {% block title %}{% endblock title %}</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Bootstrap 4 (required for AdminLTE 3.x) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  
  <!-- AdminLTE Theme style (Stable version 3.2) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
  
  <!-- Custom CSS files (keeping essential local only) -->
  <link rel="stylesheet" href="{% static 'dist/css/social.css' %}">
  <link rel="stylesheet" href="{% static 'dist/css/custom_css.css' %}">
  <link rel="stylesheet" href="{% static 'dist/css/ndas-sidebar.css' %}">

  <!-- Select2 CSS from CDN -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css">

  <!-- CSS for Video Js -->
  <link href="https://vjs.zencdn.net/8.0.4/video-js.css" rel="stylesheet" />

  {% block extra_css %}
  {% endblock extra_css %}

</head>
<body class="hold-transition sidebar-mini layout-fixed">

{% block mainbody %}


{% endblock mainbody %}

<!-- REQUIRED SCRIPTS -->

<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
// Verify jQuery loaded before proceeding
if (typeof jQuery === 'undefined') {
    console.error('❌ jQuery failed to load!');
    document.write('<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"><\/script>');
}
</script>
<!-- Bootstrap 4 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>
<!-- HTMX from CDN -->
<script src="https://unpkg.com/htmx.org@1.9.12"></script>

<!-- Select2 from CDN -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<!-- Bootstrap 4 initialization script -->
<script>
// Wait for DOM and ensure jQuery is loaded
document.addEventListener('DOMContentLoaded', function() {
    if (typeof $ === 'undefined') {
        console.error('❌ jQuery not loaded - Navigation menu may not work properly');
        return;
    }
    
    $(document).ready(function() {
        try {
            // Initialize Bootstrap 4 tooltips
            $('[data-toggle="tooltip"]').tooltip();
            
            // Initialize popovers
            $('[data-toggle="popover"]').popover();
            
            // Initialize Select2
            $('.select2').select2();
            
            console.log('✅ Bootstrap components initialized successfully');
            
            // Re-initialize for dynamically loaded content
            if (typeof window.htmx !== 'undefined') {
                document.addEventListener('htmx:afterSwap', function() {
                    // Re-initialize Bootstrap components after HTMX content swap
                    $('[data-toggle="tooltip"]').tooltip();
                    $('[data-toggle="popover"]').popover();
                    $('.select2').select2();
                });
            }
        } catch (error) {
            console.error('❌ Failed to initialize Bootstrap components:', error);
        }
    });
});
</script>

<!-- If you'd like to support IE8 (for Video.js versions prior to v7) -->
<!-- Removed duplicate script: script src="https://vjs.zencdn.net/ie8/1.1.2/videojs-ie8.min.js" -->

<!-- Library for Chart Js (using UMD version to avoid module import errors) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

<!-- Library for Video Js -->
<script src="https://vjs.zencdn.net/8.0.4/video.min.js"></script>

<!-- Video.js failsafe wrapper to prevent initialization errors -->
<script type="text/javascript" src="{% static 'js/videojs-failsafe.js' %}"></script>

<!-- Video.js zoom rotate plugin -->
<script type="text/javascript" src="{% static 'js/zoomrotate.js' %}" defer></script>

<!-- Custom rotate functionality -->
<script type="text/javascript" src="{% static 'js/rotate.js' %}" defer></script>

<!-- Ensure Video.js is loaded before plugins -->
<script type="text/javascript">
// Wait for Video.js to be fully loaded before initializing plugins
document.addEventListener('DOMContentLoaded', function() {
    if (typeof videojs === 'undefined') {
        console.warn('❌ Video.js not loaded, video functionality will be limited');
        return;
    }
    console.log('✅ Video.js loaded successfully');
});
</script>

<!-- Video.js initialization and custom scripts -->
<script type="text/javascript">
// Improved Video.js initialization with better error handling
document.addEventListener('DOMContentLoaded', function() {
    // Check if Video.js is loaded
    if (typeof videojs === 'undefined') {
        console.warn('Video.js library not loaded');
        return;
    }
    
    // Find all video elements with video-js class
    var videoElements = document.querySelectorAll('video.video-js');
    if (videoElements.length === 0) {
        // No video players on this page, skip initialization
        console.log('No video elements found on this page');
        return;
    }
    
    // Initialize each video player
    videoElements.forEach(function(videoElement) {
        // Check if player is already initialized
        if (videoElement.player) {
            console.log('Video player already initialized for element:', videoElement.id);
            return;
        }
        
        // Make sure the element has an ID
        if (!videoElement.id) {
            console.warn('Video element missing ID, skipping initialization');
            return;
        }
        
        try {
            // Initialize video player
            var player = videojs(videoElement.id, {
                controlBar: {
                    'volumePanel': false,
                },
                fluid: true,
                responsive: true
            });
            
            // Mute the player by default
            player.muted(true);
            
            // Load custom video scripts after player is ready
            player.ready(function() {
                console.log('Video.js player ready for:', videoElement.id);
                
                // Import rotate functionality if available
                if (typeof window.rotate === 'function') {
                    try {
                        window.rotate(player);
                        console.log('Rotate functionality loaded for:', videoElement.id);
                    } catch (rotateError) {
                        console.warn('Failed to load rotate functionality for ' + videoElement.id + ':', rotateError);
                    }
                } else {
                    console.log('Rotate functionality not available for:', videoElement.id);
                }
            });
            
            // Handle player errors
            player.on('error', function() {
                var error = player.error();
                console.warn('Video.js player error for ' + videoElement.id + ':', error);
            });
            
        } catch (error) {
            console.error('Video.js player initialization failed for ' + videoElement.id + ':', error);
        }
    });
});
</script>

<!-- Main application JavaScript -->
<script type="text/javascript" src="{% static 'js/utils.js' %}"></script>
<script type="text/javascript" src="{% static 'js/main.js' %}"></script>

<!-- Standard AdminLTE 3.x Sidebar Navigation -->
<script>
$(document).ready(function() {
    console.log('✅ Initializing AdminLTE 3.x standard sidebar');
    
    // Verify AdminLTE is loaded
    if (typeof $.AdminLTE === 'undefined') {
        console.warn('❌ AdminLTE 3 library not detected');
        return;
    }
    
    // Standard AdminLTE menu highlighting
    function highlightActiveMenu() {
        const currentUrl = window.location.href;
        const currentPath = window.location.pathname;
        
        // Remove existing active states
        $('.nav-sidebar .nav-link').removeClass('active');
        $('.nav-sidebar .nav-item').removeClass('menu-open');
        
        // Find and highlight active menu item
        $('.nav-sidebar .nav-link[href]').each(function() {
            const linkHref = $(this).attr('href');
            
            // Skip hash links
            if (!linkHref || linkHref === '#') return;
            
            // Check for exact match or path contains link
            if (currentUrl === linkHref || 
                (linkHref !== '/' && currentPath.includes(linkHref))) {
                
                // Add active class to link
                $(this).addClass('active');
                
                // Open parent menu if this is a submenu item
                const $parentNavItem = $(this).closest('.nav-treeview').closest('.nav-item');
                if ($parentNavItem.length) {
                    $parentNavItem.addClass('menu-open');
                    $parentNavItem.find('> .nav-link').addClass('active');
                }
                
                return false; // Stop iteration on first match
            }
        });
    }
    
    // Initialize menu highlighting
    highlightActiveMenu();
    
    // Re-highlight on HTMX page changes
    if (typeof window.htmx !== 'undefined') {
        document.addEventListener('htmx:afterSwap', function() {
            setTimeout(highlightActiveMenu, 100);
        });
    }
    
    console.log('✅ AdminLTE sidebar initialized');
});
</script>

<!-- Debug script (can be removed after fixing issues) -->
<script type="text/javascript" src="{% static 'js/debug.js' %}"></script>

{% block extra_js %}
{% endblock extra_js %}





















</body>
</html>