{% load static %}
<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>NDAS : {% block title %}{% endblock title %}</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Bootstrap 4 (required for AdminLTE 3.x) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
  
  <!-- AdminLTE Theme style (Stable version 3.2) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
  
  <!-- Custom CSS files (keeping local) -->
  <link rel="stylesheet" href="{% static 'dist/css/social.css' %}">
  <link rel="stylesheet" href="{% static 'dist/css/custom_css.css' %}">
  <link rel="stylesheet" href="{% static 'dist/css/menu.css' %}">

  <!-- Select2 -->
  <link rel="stylesheet" href="{% static 'plugins/select2/css/select2.min.css' %}">

  <!-- CSS for Video Js -->
  <link href="https://vjs.zencdn.net/8.0.4/video-js.css" rel="stylesheet" />

</head>
<body class="hold-transition sidebar-mini layout-fixed">

{% block mainbody %}


{% endblock mainbody %}

<!-- REQUIRED SCRIPTS -->

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
// Verify jQuery loaded before proceeding
if (typeof jQuery === 'undefined') {
    console.error('❌ jQuery failed to load!');
    document.write('<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"><\/script>');
}
</script>
<!-- Bootstrap 4 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<!-- AdminLTE App -->
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>
<!-- HTMX -->
<script src="{% static 'plugins/HTMX/htmx.min.js' %}"></script>

<!-- Bootstrap 4 initialization script -->
<script>
// Wait for DOM and ensure jQuery is loaded
document.addEventListener('DOMContentLoaded', function() {
    if (typeof $ === 'undefined') {
        console.error('❌ jQuery not loaded - Navigation menu may not work properly');
        return;
    }
    
    $(document).ready(function() {
        try {
            // Initialize Bootstrap 4 tooltips
            $('[data-toggle="tooltip"]').tooltip();
            
            // Initialize popovers
            $('[data-toggle="popover"]').popover();
            
            // Initialize Select2
            $('.select2').select2();
            
            console.log('✅ Bootstrap components initialized successfully');
            
            // Re-initialize for dynamically loaded content
            if (typeof window.htmx !== 'undefined') {
                document.addEventListener('htmx:afterSwap', function() {
                    // Re-initialize Bootstrap components after HTMX content swap
                    $('[data-toggle="tooltip"]').tooltip();
                    $('[data-toggle="popover"]').popover();
                    $('.select2').select2();
                });
            }
        } catch (error) {
            console.error('❌ Failed to initialize Bootstrap components:', error);
        }
    });
});
</script>

<!-- If you'd like to support IE8 (for Video.js versions prior to v7) -->
<!-- Removed duplicate script: script src="https://vjs.zencdn.net/ie8/1.1.2/videojs-ie8.min.js" -->

<!-- Library for Chart Js (using UMD version to avoid module import errors) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

<!-- Library for Video Js -->
<script src="https://vjs.zencdn.net/8.0.4/video.min.js"></script>

<!-- Video.js failsafe wrapper to prevent initialization errors -->
<script type="text/javascript" src="{% static 'js/videojs-failsafe.js' %}"></script>

<!-- Video.js zoom rotate plugin -->
<script type="text/javascript" src="{% static 'js/zoomrotate.js' %}" defer></script>

<!-- Custom rotate functionality -->
<script type="text/javascript" src="{% static 'js/rotate.js' %}" defer></script>

<!-- Ensure Video.js is loaded before plugins -->
<script type="text/javascript">
// Wait for Video.js to be fully loaded before initializing plugins
document.addEventListener('DOMContentLoaded', function() {
    if (typeof videojs === 'undefined') {
        console.warn('❌ Video.js not loaded, video functionality will be limited');
        return;
    }
    console.log('✅ Video.js loaded successfully');
});
</script>

<!-- Video.js initialization and custom scripts -->
<script type="text/javascript">
// Improved Video.js initialization with better error handling
document.addEventListener('DOMContentLoaded', function() {
    // Check if Video.js is loaded
    if (typeof videojs === 'undefined') {
        console.warn('Video.js library not loaded');
        return;
    }
    
    // Find all video elements with video-js class
    var videoElements = document.querySelectorAll('video.video-js');
    if (videoElements.length === 0) {
        // No video players on this page, skip initialization
        console.log('No video elements found on this page');
        return;
    }
    
    // Initialize each video player
    videoElements.forEach(function(videoElement) {
        // Check if player is already initialized
        if (videoElement.player) {
            console.log('Video player already initialized for element:', videoElement.id);
            return;
        }
        
        // Make sure the element has an ID
        if (!videoElement.id) {
            console.warn('Video element missing ID, skipping initialization');
            return;
        }
        
        try {
            // Initialize video player
            var player = videojs(videoElement.id, {
                controlBar: {
                    'volumePanel': false,
                },
                fluid: true,
                responsive: true
            });
            
            // Mute the player by default
            player.muted(true);
            
            // Load custom video scripts after player is ready
            player.ready(function() {
                console.log('Video.js player ready for:', videoElement.id);
                
                // Import rotate functionality if available
                if (typeof window.rotate === 'function') {
                    try {
                        window.rotate(player);
                        console.log('Rotate functionality loaded for:', videoElement.id);
                    } catch (rotateError) {
                        console.warn('Failed to load rotate functionality for ' + videoElement.id + ':', rotateError);
                    }
                } else {
                    console.log('Rotate functionality not available for:', videoElement.id);
                }
            });
            
            // Handle player errors
            player.on('error', function() {
                var error = player.error();
                console.warn('Video.js player error for ' + videoElement.id + ':', error);
            });
            
        } catch (error) {
            console.error('Video.js player initialization failed for ' + videoElement.id + ':', error);
        }
    });
});
</script>

<!-- Main application JavaScript -->
<script type="text/javascript" src="{% static 'js/utils.js' %}"></script>
<script type="text/javascript" src="{% static 'js/main.js' %}"></script>

<!-- Debug script (can be removed after fixing issues) -->
<script type="text/javascript" src="{% static 'js/debug.js' %}"></script>

{% block extra_js %}
{% endblock extra_js %}





















</body>
</html>