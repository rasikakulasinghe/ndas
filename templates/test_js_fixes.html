{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript Fixes Test - NDAS</title>
    <link href="https://vjs.zencdn.net/8.0.4/video-js.css" rel="stylesheet">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; }
        .success { color: green; }
        .error { color: red; }
        .warning { color: orange; }
        #consoleOutput { 
            background: #f5f5f5; 
            padding: 15px; 
            font-family: monospace; 
            white-space: pre-line; 
            border: 1px solid #ddd; 
            max-height: 300px; 
            overflow-y: auto; 
        }
    </style>
</head>
<body>
    <h1>üîß JavaScript Fixes Test - NDAS Project</h1>
    <p><strong>Status:</strong> Testing the fixes for Chart.js and Video.js loading issues</p>
    
    <div class="test-section">
        <h2>1. üìä Chart.js Test</h2>
        <canvas id="testChart" width="400" height="200"></canvas>
        <div id="chartStatus"></div>
    </div>
    
    <div class="test-section">
        <h2>2. üé• Video.js Test</h2>
        <video id="videoPlayer" class="video-js" controls preload="auto" width="640" height="264">
            <source src="https://sample-videos.com/zip/10/mp4/SampleVideo_1280x720_1mb.mp4" type="video/mp4">
            <p class="vjs-no-js">
                To view this video please enable JavaScript, and consider upgrading to a web browser that
                <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>.
            </p>
        </video>
        <div id="videoStatus"></div>
    </div>
    
    <div class="test-section">
        <h2>3. üîç Debug Console Output</h2>
        <div id="consoleOutput"></div>
    </div>

    <!-- Scripts using Django static files exactly like your application -->
    <!-- jQuery -->
    <script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
    
    <!-- Chart.js from CDN (like in your base template) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.2.1/chart.min.js" integrity="sha512-v3ygConQmvH0QehvQa6gSvTE2VdBZ6wkLOlmK7Mcy2mZ0ZF9saNbbk19QeaoTHdWIEiTlWmrwAL4hS8ElnGFbA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- Video.js from CDN -->
    <script src="https://vjs.zencdn.net/8.0.4/video.min.js"></script>
    
    <!-- Your custom scripts -->
    <script src="{% static 'js/zoomrotate.js' %}"></script>
    <script src="{% static 'js/rotate.js' %}"></script>
    <script src="{% static 'js/main.js' %}"></script>
    <script src="{% static 'js/debug.js' %}"></script>
    
    <!-- Test Script -->
    <script>
        // Capture console output
        var consoleOutput = document.getElementById('consoleOutput');
        var originalLog = console.log;
        var originalError = console.error;
        var originalWarn = console.warn;
        
        function addToOutput(type, message) {
            consoleOutput.textContent += `[${type}] ${message}\n`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToOutput('LOG', args.join(' '));
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addToOutput('ERROR', args.join(' '));
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToOutput('WARN', args.join(' '));
        };
        
        document.addEventListener('DOMContentLoaded', function() {
            var chartStatus = document.getElementById('chartStatus');
            var videoStatus = document.getElementById('videoStatus');
            
            console.log('=== NDAS JavaScript Test Started ===');
            
            // Test 1: Chart.js
            try {
                if (typeof Chart === 'undefined') {
                    throw new Error('Chart.js not loaded');
                }
                
                console.log('Chart.js available, creating test chart...');
                
                const ctx = document.getElementById('testChart');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Before Fix', 'After Fix', 'Success Rate'],
                        datasets: [{
                            label: 'Test Results (%)',
                            data: [0, 100, 98],
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.2)',
                                'rgba(54, 162, 235, 0.2)',
                                'rgba(75, 192, 192, 0.2)'
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(75, 192, 192, 1)'
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: '‚úÖ Chart.js Working - No Import Errors!'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
                
                chartStatus.innerHTML = '<span class="success">‚úÖ Chart.js: SUCCESS - No import statement errors, chart rendered successfully!</span>';
                console.log('Chart.js test: SUCCESS');
                
            } catch (error) {
                chartStatus.innerHTML = '<span class="error">‚ùå Chart.js: FAILED - ' + error.message + '</span>';
                console.error('Chart.js test failed:', error);
            }
            
            // Test 2: Video.js  
            setTimeout(function() {
                try {
                    if (typeof videojs === 'undefined') {
                        throw new Error('Video.js not loaded');
                    }
                    
                    console.log('Video.js available, testing player initialization...');
                    
                    var videoElement = document.getElementById('videoPlayer');
                    if (!videoElement) {
                        throw new Error('Video element not found');
                    }
                    
                    // Check if player is already initialized by other scripts
                    if (videoElement.player) {
                        videoStatus.innerHTML = '<span class="success">‚úÖ Video.js: SUCCESS - Player already initialized by application scripts</span>';
                        console.log('Video.js test: SUCCESS (already initialized)');
                        return;
                    }
                    
                    // Initialize player manually for test
                    var player = videojs('videoPlayer', {
                        controlBar: {
                            'volumePanel': false,
                        },
                        fluid: true,
                        responsive: true
                    });
                    
                    player.ready(function() {
                        videoStatus.innerHTML = '<span class="success">‚úÖ Video.js: SUCCESS - Player initialized and ready without errors</span>';
                        console.log('Video.js test: SUCCESS (player ready)');
                        
                        // Test rotate functionality if available
                        if (typeof window.rotate === 'function') {
                            console.log('Rotate function available, testing...');
                            try {
                                window.rotate(player);
                                console.log('Rotate functionality test: SUCCESS');
                            } catch (rotateError) {
                                console.warn('Rotate functionality test: FAILED -', rotateError.message);
                            }
                        }
                    });
                    
                    player.on('error', function() {
                        var error = player.error();
                        videoStatus.innerHTML = '<span class="warning">‚ö†Ô∏è Video.js: Player initialized but video error - ' + (error ? error.message : 'Unknown video error') + '</span>';
                        console.warn('Video player error:', error);
                    });
                    
                    // Set initial status
                    if (!videoStatus.innerHTML) {
                        videoStatus.innerHTML = '<span class="success">‚úÖ Video.js: Player created successfully, waiting for ready state...</span>';
                    }
                    
                } catch (error) {
                    videoStatus.innerHTML = '<span class="error">‚ùå Video.js: FAILED - ' + error.message + '</span>';
                    console.error('Video.js test failed:', error);
                }
            }, 2000); // Delay to let other scripts initialize first
            
            console.log('=== Tests initialized, check results above ===');
        });
    </script>

</body>
</html>
